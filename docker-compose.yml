services:
  apache:
    build:
        context: .
        dockerfile: Dockerfile
    container_name: SWEB-apache-php8.3
    restart: unless-stopped
    extra_hosts:
        - "host.docker.internal:host-gateway"
    volumes:
        - ./site:/var/www/html #mettre dans site les fichiers web du projet
    ports:
        - 8000:80
        - 9003:9003            # port Xdebug (optionnel si host.docker.internal fonctionne)
    depends_on:
        - mysql
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost/ || exit 1"]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s
  mysql:
    image: mysql:latest
    container_name: SBDD-mysql
    environment: #infos d'initialisation de la BDD
        MYSQL_ROOT_PASSWORD: root
        MYSQL_USER: admin
        MYSQL_PASSWORD: mdp@dm1nTPphp
        MYSQL_TCP_PORT: 3306
    volumes:
        - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql # changer le script init.sql présent dans le dossier database pour donner les droits admin à l'utilisateur user
        - ./database:/docker-entrypoint-initdb.d # mettre dans le dossier database le script .sql pour initialiser la bdd métier
        - ./database/db_data:/var/lib/mysql # mettre dans le dossier database/db_data les fichiers de la BDD pour garder les évolutions
    ports:
        - "3306:3306"
  
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: Sweb-phpmyadmin
    environment:
                PMA_HOST: mysql
        PMA_PORT: 3306
    ports:
        - '8080:80'
    depends_on:
        - mysql
